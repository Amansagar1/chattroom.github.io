!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("zipy-rrweb"),require("uuid")):"function"==typeof define&&define.amd?define(["exports","zipy-rrweb","uuid"],n):n((e||self).zipyai={},e.zipyRrweb,e.uuid)}(this,function(e,n,t){var r,o,i;!function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.ReplayerEvent=11]="ReplayerEvent",e[e.ConsoleInfo=50]="ConsoleInfo",e[e.ConsoleError=51]="ConsoleError",e[e.ConsoleWarning=52]="ConsoleWarning",e[e.ConsoleDebug=53]="ConsoleDebug",e[e.Error=70]="Error",e[e.RangeError=71]="RangeError",e[e.ReferenceError=72]="ReferenceError",e[e.TypeError=73]="TypeError",e[e.SyntaxError=74]="SyntaxError",e[e.URIError=75]="URIError",e[e.EvalError=76]="EvalError",e[e.UnhandledRejection=77]="UnhandledRejection",e[e.BROWSERDATA=100]="BROWSERDATA",e[e.NAVIGATION=101]="NAVIGATION",e[e.Online=102]="Online",e[e.Offline=103]="Offline",e[e.XHR=104]="XHR",e[e.WSOPEN=105]="WSOPEN",e[e.WSCLOSE=106]="WSCLOSE",e[e.WSMESSAGE=107]="WSMESSAGE",e[e.WSERROR=108]="WSERROR",e[e.Fonts=109]="Fonts",e[e.Link=110]="Link",e[e.Css=111]="Css",e[e.Image=112]="Image",e[e.Js=113]="Js",e[e.Media=114]="Media",e[e.ZipyLogMessage=115]="ZipyLogMessage",e[e.ZipyLogException=116]="ZipyLogException",e[e.ZipyLogFrontendError=117]="ZipyLogFrontendError",e[e.ZipyLogNetworkError=118]="ZipyLogNetworkError",e[e.Performance=119]="Performance",e[e.PerfNavigation=120]="PerfNavigation",e[e.OtherNetworkCall=121]="OtherNetworkCall"}(r||(r={})),function(e){e[e.MESSAGESEND=0]="MESSAGESEND",e[e.MESSAGERECEIVED=1]="MESSAGERECEIVED",e[e.SOCKETCLOSE=2]="SOCKETCLOSE",e[e.SOCKETERROR=3]="SOCKETERROR",e[e.SOCKETOPEN=4]="SOCKETOPEN"}(o||(o={})),function(e){e[e.ELEMENT=0]="ELEMENT",e[e.EVENT=1]="EVENT",e[e.FIRST_INPUT=2]="FIRST_INPUT",e[e.LARGEST_CONTENTFUL_PAINT=3]="LARGEST_CONTENTFUL_PAINT",e[e.LAYOUT_SHIFT=4]="LAYOUT_SHIFT",e[e.LONGTASK=5]="LONGTASK",e[e.MARK=6]="MARK",e[e.MEASURE=7]="MEASURE",e[e.NAVIGATION=8]="NAVIGATION",e[e.PAINT=9]="PAINT",e[e.RESOURCE=10]="RESOURCE"}(i||(i={}));var s,a,c,u="zipy",d="rrweb";!function(e){e[e.POSTENDUSERINFOANDGETUSERCONFIG=0]="POSTENDUSERINFOANDGETUSERCONFIG",e[e.POSTENDUSERINFO=1]="POSTENDUSERINFO",e[e.GETUSERCONFIG=2]="GETUSERCONFIG"}(s||(s={})),function(e){e[e.ANONYMS=0]="ANONYMS",e[e.IDENTIFIED=1]="IDENTIFIED"}(a||(a={})),function(e){e[e.NORECORDING=0]="NORECORDING",e[e.RECORDINGPENDING=1]="RECORDINGPENDING",e[e.RECORDINGSUCCESSFUL=2]="RECORDINGSUCCESSFUL"}(c||(c={}));var l,f,p,g="logEvent",v="exceptionEvent",y="errorEvent",w=1024,m="startIframeRecording",h="stopIframeRecording",E="iframeContentLoaded";(p=l||(l={})).DEBUG="1",p.WARNING="2",p.ERROR="3",p.LOG="4",function(e){e[e.BLOCKING=0]="BLOCKING",e[e.NON_BLOCKING=1]="NON_BLOCKING"}(f||(f={}));var S={streamMgrUrl:"https://services.zipy.ai/sdk-session-manager/v2/enduser-info",registerSessionUrl:"https://services.zipy.ai/sdk-session-manager/v1/register-sdk-session",sdkVersion:"1.0.4",errorUrl:"divolte.collector",streamMgrRetryCount:5,zipyDeploymentEnviornment:"Production",sdkLoopTime:1e3,perfLoopTime:5e3,ignoreEmptyErros:!0,ignoreLargeResponse:!0,debugLogs:!1,sessionLinkUrl:"https://app.zipy.ai"},z=!1;function I(e){z&&console.info(u,e)}function C(e){z&&console.debug(u,e)}function k(e){z&&console.log(u,e)}function N(e){z&&console.error(u,e)}function R(){return R=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},R.apply(this,arguments)}function O(e,n){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},O(e,n)}function b(e,n,t){return b=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,n,t){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(e,r));return t&&O(o,t.prototype),o},b.apply(null,arguments)}function T(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function U(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return T(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?T(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(){return Date.now()}function x(e,n,t){var r={capture:!0,passive:!0};return t.addEventListener(e,n,r),function(){return t.removeEventListener(e,n,r)}}function P(){var e=Math.floor(Date.now()/1e3);return t.v4()+"-"+e}function L(e){var n={externalId:"enduser_external_id",firstName:"eu_first_name",lastName:"eu_last_name",email:"eu_email",age:"eu_age",customerName:"eu_customer_name",avatar:"eu_avatar",phone:"eu_phone"};return e in n?n[e]:e}var A={domCapture:!0,consoleCapture:!0,networkCapture:!0,stackTraceCapture:!0,webSocketsCapture:!1,ipCapture:!0,inputMasking:!0,textMasking:!0,paid:!1,apiKey:"",streamUrl:"https://collector.zipy.ai",perfUrl:"https://perfcollector.zipy.ai",maxBufferSize:5e6,compression:!0,compressionType:"gzip",timeFrequency:1e3,perfTimeFrequency:5e3,encodingType:"",sessionTimeout:18e5,failureRetryCount:5,bufferSizeFrequency:1048576,perfBufferSizeFrequency:1024,ignoreUrl:["google.com","zipy.ai","mixpanel","extreme-ip-lookup.com","hotjar","smartlook.com","newrelic.com","bugsnag","fullstory","sentry.io","google-analytics.com","bam.nr-data.net","wistia.com","amplitude.com","segment.io","pendo.io","raygun","smartlook.cloud","segment.com","visualstudio.com","stats.g.doubleclick.net","pagead2.googlesyndication.com","r.lr-in.com","clarity.ms","appcues.net","datadoghq.com"],ignoreError:["rrweb","zipy","Script error","pagead2.googlesyndication.com","adsbygoogle"],ignoreConsole:["{}"],isIgnoreUrlError:["google.com","zipy.ai","mixpanel","extreme-ip-lookup.com","hotjar","smartlook.com","newrelic.com","bugsnag","fullstory","sentry.io","google-analytics.com","bam.nr-data.net","wistia.com","amplitude.com","segment.io","pendo.io","raygun","smartlook.cloud","segment.com","visualstudio.com","stats.g.doubleclick.net","pagead2.googlesyndication.com","r.lr-in.com","clarity.ms","appcues.net","datadoghq.com"],isIgnoreConsoleError:["{}"],ip:"",pack:!1,blockClasses:"zipy-block",xhrReqPayloadCapture:!1,xhrRespPayloadCapture:!1,canvasCapture:!1,scrubbingKey:["password","secret","passwd","api_key","apikey","access_token","auth","credentials","mysql_pwd","stripetoken","cardnumber"],requestCapSize:1e6,responseCapSize:1e6,sizeExceededMessage:{message:"size too large",source:"zipy"},eventCountCapInSingleChunk:0,captureCustomZipyLogMessage:!1,captureCustomZipyLogError:!1,captureCustomZipyLogException:!1,startCaptureWithoutUserActivity:!1,consoleLogLevel:"3",recordCrossOriginIframes:!0,splitSessionSize:0,capturePerformance:!1,isApiIdentifierEnable:!1,apiUniqueIdentifier:[],ignoreUrlErrorCodes:{},ignoreUrlCodes:{}};function _(e){return R({},e,{timestamp:D()})}function F(){try{return window.sdkConfig?window.sdkConfig:A}catch(e){return N("Failed to parse end user Info data"),A}}function M(e){try{var n=F();return n&&n.hasOwnProperty&&n.hasOwnProperty(e)?n[e]:null}catch(e){return N(e.message?JSON.stringify(e):e),null}}var q=function(e,n,t){return e&&e.constructor===String&&t.indexOf(e)===n},G=function(e){return e&&e.constructor===String&&e.trim()};function j(){var e=M("headersToSanitize");return e&&e.length?e.split(","):[]}function J(e){if(!Array.isArray(e))return[];for(var n,t=[],r=U(e);!(n=r()).done;){var o=n.value;try{o&&"object"==typeof o&&JSON.stringify(o)?o.constructor.name.toLowerCase().includes("error")?t.push({message:o.message,name:o.name,stack:o.stack}):t.push(o):t.push(String(o))}catch(e){t.push("[console log value cannot be serialized]")}}return t}var Z=[];try{Z=M("scrubbingKey")||[]}catch(e){N("Error in obtaining scrubbing keys"),Z=A.scrubbingKey}function B(e,n,t){t++;try{e&&"object"==typeof e&&t<=2&&Object.keys(e).forEach(function(r){Z.includes(r.toLowerCase())&&(e[r]="xxx"),n.push(r);var o=e[r];"object"==typeof o&&B(o,n,t)})}catch(e){N("error while hiding the sensitive information: "+e)}return JSON.stringify(e)}function H(e,n,t,r){var o=r?e.request:e.response,i=M(r?"xhrReqPayloadCapture":"xhrRespPayloadCapture"),s=function(n){try{r?(e.request=n,""!=e.request&&(e.requestByteSize=t)):(e.response=n,""!=e.response&&(e.responseByteSize=t))}catch(e){N("error while converting xhr data to string"+e)}};if(i){var a=M("responseCapSize")||1e6,c=M("requestCapSize")||1e6,u=r?c:a,d=M("sizeExceededMessage");"string"==typeof o&&o.length>0?(t=t||o.length)<=u?function(){try{s(B(JSON.parse(o),[],n))}catch(n){var e=Z.some(function(e){return o.indexOf(e)>=0});s(o=r?e?"No request payload captured for this request as you may have some sensitive information in the payload.":o:e?"No response captured for this request as you may have some sensitive information in the payload.":o)}}():t>0&&s(JSON.stringify(d)):"object"==typeof o?(t=t||JSON.stringify(o,null,4).length)<=u?s(B(o,[],n)):t>0&&s(d):o&&o.length>0&&((t=t||o.length)<=u?s(B(o,[],n)):t>0&&s(JSON.stringify(d)))}else r?e.request="":e.response="";return e}function W(e){if(!e)return!1;var n=e.toLowerCase(),t=M("ignoreError")||[];try{if(t.some(function(e){return n.includes(e.toLowerCase())}))return C("Ignoring error for data: "+e),!0}catch(e){N("Error in ignore errors. Error - "+e.message)}return!1}function K(){try{return window.self!==window.top}catch(e){return!0}}var V=function(e){try{return Promise.resolve(new Promise(function(n,t){try{var r=function(e){n(o)},o="",i=function(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}(function(){var n;if(!e||"Response"!==(null==e||null==(n=e.constructor)?void 0:n.name))throw new Error("No valid Response object to process!");return Promise.resolve(null==e?void 0:e.text()).then(function(e){(o=e)&&o.length&&(o=JSON.parse(o))})},function(e){N("Error while getting json of response: "+e.message)});return Promise.resolve(i&&i.then?i.then(r):r())}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}};function X(e,n){if(e&&null!=e)try{var t="";t="string"!=typeof e?JSON.stringify(e):e;for(var o=r.RangeError;o<=r.EvalError;o++)if(-1!=t.search(r[o]))return o}catch(e){N(e)}return n}function Y(e){switch(e){case"link":case"css":return r.Link;case"img":case"image":return r.Image;case"script":return r.Js;case"fetch":case"beacon":case"xmlhttprequest":return r.XHR;case"other":return r.OtherNetworkCall;default:return 0}}var $,Q=["img","script","css","link","image","script"];function ee(e,n,t){try{var r,o=M("isIgnoreUrlError"),i=M("ignoreUrl"),s=M("ignoreUrlErrorCodes"),a=M("ignoreUrlCodes"),c={};t?(r=o,c=s||{}):(r=i,c=a||{});var u=e.indexOf("?");u>0&&(e=e.substr(0,u));var d=function(e,t){return!!e.includes(t.toLowerCase())&&function(e){return!c.hasOwnProperty(e)||c[e].includes(n)}(t)},l=e.toLowerCase(),f=function(e){try{var n=e.match(/\/\d+\//g);if(n)for(var t,r=U(n);!(t=r()).done;)e=e.replace(t.value,"/{id}/")}catch(e){N("Error while masking numeric value.")}return e}(e.toLowerCase());if(r.some(function(e){return e.includes("{id}")?d(f,e):d(l,e)}))return!0}catch(n){N("Error in url decoding for url : "+e+" Error is - "+n)}return!1}function ne(e){return{initiatorType:e.initiatorType,nextHopProtocol:e.nextHopProtocol,workerStart:e.workerStart,redirectStart:e.redirectStart,redirectEnd:e.redirectEnd,fetchStart:e.fetchStart,domainLookupStart:e.domainLookupStart,domainLookupEnd:e.domainLookupEnd,connectStart:e.connectStart,connectEnd:e.connectEnd,secureConnectionStart:e.secureConnectionStart,requestStart:e.requestStart,responseStart:e.responseStart,responseEnd:e.responseEnd,transferSize:e.transferSize,encodedBodySize:e.encodedBodySize,decodedBodySize:e.decodedBodySize,responseStatus:e.responseStatus,renderBlockingStatus:e.renderBlockingStatus,duration:e.duration,entryType:e.entryType,name:e.name,startTime:e.startTime}}function te(e,n){return!(e.indexOf("http://")>-1||e.indexOf("https://")>-1)&&new URL(n).pathname===e}function re(e){if("online"!=(navigator.onLine?"online":"offline")){if(!window.iszInternetDisconnected)return window.iszInternetDisconnected=!0,C("handleConnectionChange :: send internet disconnected"),e(_({eventType:r.Offline,data:{status:"Offline",type:""},isError:!1}))}else var n=setInterval(function(){fetch("//google.com",{mode:"no-cors"}).then(function(){return window.iszInternetDisconnected&&(window.iszInternetDisconnected=!1,C("handleConnectionChange :: send internet connected"),e(_({eventType:r.Online,data:{status:"Online",type:""},isError:!1}))),clearInterval(n)}).catch(function(){window.iszInternetDisconnected||(window.iszInternetDisconnected=!0,C("handleConnectionChange :: send internet disconnected"),e(_({eventType:r.Offline,data:{status:"Offline",type:""},isError:!1})))})},5e3)}var oe=new Map;function ie(e){try{var n=window.localStorage.getItem(e);return!n&&(I("fetched value from hashmap :"+(n=oe.get(e))),n)?(I("Going to update local storage:"),function(){try{I("inside localStorageUpdate function");for(var e,n=U(oe.entries());!(e=n()).done;){var t=e.value;se(t[0],t[1])}}catch(e){N("inside updateLocalStorage catch block ${e.message}")}}(),n):n}catch(e){return void N("inside zLocalStorageGetItem catch block ${e.message}")}}function se(e,n){try{I("inside zLocalStorageSetItem for key :"+e+" and value :"+n),oe.set(e,n),window.localStorage.setItem(e,n)}catch(e){N("inside zLocalStorageSetItem catch block ${e.message}")}}function ae(e){try{I("inside zLocalStorageRemoveItem for key :"+e),oe.delete(e),window.localStorage.removeItem(e)}catch(e){N("inside zLocalStorageSetItem catch block ${e.message}")}}function ce(){var e=ie("zsdk-config");if(e)try{return JSON.parse(e)}catch(e){return void N("Failed to parse sdk Config Data")}}function ue(e){var n={isBlocked:!1,blockedEndTime:0,apiKey:e};try{window.zSessionBlockedInfo=n,I("Updating zsession-blocked-info"+JSON.stringify(n)),se("zsession-blocked-info",JSON.stringify(n))}catch(e){N("Failed to stringify zsession-blocked-info ")}}function de(){var e=ie("zsession-blocked-info");if(e)try{var n=JSON.parse(e);return window.zSessionBlockedInfo=n,n}catch(e){return void N("Failed to parse zsession-blocked-info")}}function le(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}var fe=function e(n,t,r,o,i){void 0===t&&(t=5),void 0===i&&(i={});try{return Promise.resolve(le(function(){var s=new URL(n);return null!=r&&Object.keys(r).forEach(function(e){return s.searchParams.append(e,r[e])}),Promise.resolve(fetch(s.href,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).then(function(s){return s.ok?(C("postDataOnServer :: Response status = "+s.status),Promise.resolve(s.json()).then(function(e){return C("postDataOnServer :: Response JSON = "+e),e})):404==s.status?(se("is-api-key-valid","false"),we(!1),!1):(C("Error :: Response status = "+s.status),t>0?e(n,t-1,r,o,i):(N("Not able to post enduser config after multiple retries"),!1))})},function(e){return N("Not able to get response from server with ERROR: "+e),!1}))}catch(e){return Promise.reject(e)}},pe=function e(n,t,r){try{return Promise.resolve(le(function(){return Promise.resolve(fetch(n,{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip"},body:JSON.stringify(t)})).then(function(o){return o.ok?(C("Response status = "+o.status),!0):(C("Error :: Response status = "+o.status),r>0?e(n,t,r-1):(N("Not able to send data after all retries"),!1))})},function(e){return N("Not able to get response from server with ERROR: "+e),!1}))}catch(e){return Promise.reject(e)}},ge=function e(t){var r=t.divolteUrl,o=t.divolteJson,i=t.failureRetryCount;try{return Promise.resolve(le(function(){var t=JSON.stringify(o);return Promise.resolve(fetch(r,{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip"},body:t})).then(function(s){if(F()&&F().splitSessionSize>0){var a=(new TextEncoder).encode(t).byteLength;k("Request size "+a),function(e){try{var t=ie("ztotal-data-sent")?ie("ztotal-data-sent"):"0",r=parseInt(t)+e;k("Current data size "+t),k("Merged data size "+r),r>F().splitSessionSize?(function(){try{k("Trigger checkout flow triggered"),n.record.takeFullSnapshot(!0)}catch(e){N("Error in checking full snapshot. Error is - "+e.message)}}(),se("ztotal-data-sent","0"),k("Resetting data to size zero")):se("ztotal-data-sent",JSON.stringify(r))}catch(e){N("Error in checking data size. Error is - "+e.message)}}(a)}return s.ok?(C("Response status = "+s.status),!0):(C("Error :: Response status = "+s.status),i>0?e({divolteUrl:r,divolteJson:o,failureRetryCount:i-1}):(N("Not able to send data after all retries"),!1))})},function(e){return N("Not able to get response from server with ERROR: "+e),!1}))}catch(e){return Promise.reject(e)}},ve=!0;function ye(){return ve}function we(e){ve=e}function me(){var e=ie("session-data");if(e)try{return JSON.parse(e)}catch(e){return void N("Failed to parse session data")}}function he(e){if(window.iszSessionExpired)return C("Session is already expired"),!0;var n=(me()||{}).sessionId,t=Number(ie("last-activity-time"));return!n||t+e.sessionTimeout<=Date.now()?(I("Session is expired"),window.iszSessionExpired=!0,!0):!function(e){var n=Ee();return!(!n||n+e.sessionTimeout<=Date.now())}(e)}function Ee(){try{var e=window.zenduserLastActivityTime;if(!e){if(!(e=ie("zenduser-last-activity-time")))return 0;e=Number(e)}return e}catch(e){return N("inside getZendUserActivityTime catch block"),0}}function Se(){var e=ie("pack");if(!e){var n=F();se("pack",e=n.pack?n.pack.toString():(!1).toString())}return"true"===e}function ze(e){var n=ie("zId");n||se("zId",n=P());var t=P(),r="0:"+P().replace("-",":");!function(e){ae("pack"),ue(e)}(e),ae("pack");var o={sessionId:t,dSession:r,isNewSession:!0,sdkKey:e,isActive:!1};se("is-api-key-valid","true"),we(!0);try{I("Created new Session"+JSON.stringify(o)),se("session-data",JSON.stringify(o)),se("last-activity-time",Date.now().toString()),window.iszSessionExpired=!1}catch(e){N("Failed to stringify  session data")}}function Ie(e){var n=me();return!!n&&e!==(null==n?void 0:n.sdkKey)&&(I("Sdk key is chnaged going to create session data"),!0)}function Ce(){var e=ie("zId");return e||(se("zId",e=P()),e)}function ke(){var e=ie("zenduser-info");if(e)try{return JSON.parse(e)}catch(e){return void N("Failed to parse end user Info data")}}function Ne(){var e=ie("zenduser-info-temp");if(e)try{return JSON.parse(e)}catch(e){return void N("Failed to parse end user Info data")}}function Re(e){Ce(),ke()||I("Creating new enduser-info"+JSON.stringify(e));try{I("Updating enduser-info"+JSON.stringify(e)),se("zenduser-info",JSON.stringify(e))}catch(e){N("Failed to stringify  enduser-info ")}}function Oe(e){Ce(),ke()||I("Creating new enduser-info-temp"+JSON.stringify(e));try{I("Updating enduser-info-temp"+JSON.stringify(e)),se("zenduser-info-temp",JSON.stringify(e))}catch(e){N("Failed to stringify  enduser-info-temp ")}}function be(){Ne()?(I("Removing zenduser-info-temp"),ae("zenduser-info-temp")):I("zenduser temp Data dosen't exists")}function Te(e,n){e.euId=0,e.euZName="",e.isBlocked=!1,e.zAnonymsUserInfo={euId:0,euZName:"",zId:null!=n?n:""}}function Ue(e,n){var t,r,o=Ce();(null==e||null==(t=e.zAnonymsUserInfo)?void 0:t.zId)===o?(I("ZId match"),e.euId=e.zAnonymsUserInfo.euId,e.euZName=e.zAnonymsUserInfo.euZName):(I("ZId dosen't match Zid : "+o+" and Anonyms user Zid: "+(null==e||null==(r=e.zAnonymsUserInfo)?void 0:r.zId)),Te(e,o)),n?Oe(e):Re(e)}function De(){if(Ne())return I("Temp storage has some pending data to post"),!0;var e=ke();if(!e)return I("zenduser Data dosen't exists"),!0;if(0===e.euId)return I("Euid value is 0, required to fetch data again"),!0;if(e.userType===a.ANONYMS){var n,t;if(null==e||null==(n=e.zExternalUserInfo)?void 0:n.externalId)return I("External User details exists, and userType is ANONYMS need to post data"),!0;var r=Ce();if((null==(t=e.zAnonymsUserInfo)?void 0:t.zId)!==r)return I("ZId dosen't match Zid : "+r+" and Anonyms user Zid: "+e.zAnonymsUserInfo.zId),Te(e,r),Re(e),!0;I("ZId match No need to update for anonyms user")}return!1}function xe(e){var n={};return Object.keys(e).forEach(function(t){"uniqueUserId"===t?n.externalId=e[t]:n[t]=e[t]}),n}var Pe=function(e,n,t){void 0===n&&(n=0);try{var r={v:S.sdkVersion,e:"Production",o:n,ns:t};if(n==s.POSTENDUSERINFOANDGETUSERCONFIG||n==s.GETUSERCONFIG){var o=ce();window.sdkConfig=o||A}var i=de();if(i&&i.isBlocked)return I("Not going to call post end user info as session is already blocked"),Promise.resolve(window.sdkConfig);window.iszHandshakeDone=!1,window.zpendingOp=n,C("config.sdkversion"+S.sdkVersion);var c=Ne()||{zAnonymsUserInfo:{}},u={},d=a.ANONYMS;if(c){var l,f=c.zExternalUserInfo||{};for(var p in f)u[L(p)]=f[p]?f[p]:"";u.enduser_zipy_id=null==(l=c.zAnonymsUserInfo)?void 0:l.zId,f.externalId&&(I("Get User info for user Type Identified "+f.externalId),d=a.IDENTIFIED)}return window.ztryForHandshake=!1,Promise.resolve(fe(S.streamMgrUrl+"/"+e,S.streamMgrRetryCount,r,u)).then(function(t){if(t)if((null==t?void 0:t.api_key)==e){var r=de(),o=me()||{},i=!(null==t||!t.is_blocked)&&(null==t?void 0:t.is_blocked);if(r&&(r.isBlocked||o.isActive||Ge(t,e)),i)return window.sdkConfig;if(n==s.POSTENDUSERINFOANDGETUSERCONFIG||n==s.GETUSERCONFIG){var u=qe(t);window.iszHandshakeDone=!0,I("sdkConfigResp"+JSON.stringify(u)),u&&(window.sdkConfig=u)}if(n==s.POSTENDUSERINFOANDGETUSERCONFIG||n==s.POSTENDUSERINFO){var l=t.enduser_info||{};I("Response object received for End User from stream manager: "+JSON.stringify(l)),l&&(I("Going to add enduser info after data parsing"),c.userType=d,c.euId=l.id?l.id:0,c.euZName=l.zipy_eu_name?l.zipy_eu_name:"",c.isBlocked=!!l.is_blocked&&l.is_blocked,d==a.ANONYMS&&(c.zAnonymsUserInfo.euId=c.euId,c.zAnonymsUserInfo.euZName=c.euZName,c.zExternalUserInfo={}),Re(c),be())}}else N("Not able to get response from stream manager for sdk Key: "+e);else N("Not able to get response from stream manager ");return window.sdkConfig})}catch(e){return Promise.reject(e)}},Le=function(e){try{var n,t=F();C("Data Length for direct streaming ");var r=window.zEventsPerfData||[],o=r.length,i=function(){if(2*r.length>=t.perfBufferSizeFrequency||window.perfLastSyncTime+t.perfTimeFrequency<=Date.now()&&o>0){var i,s,a=r.slice(0,o),c=me()||{},u=ke()||{},d=ie("zId"),l=null!=(i=u.zExternalUserInfo)&&i.externalId?null==(s=u.zExternalUserInfo)?void 0:s.externalId:"",f=/\((.*)\)/.exec((new Date).toString())[1],p={key:e,sdk_ver:S.sdkVersion,src:"Frontend",s_id:c.sessionId,euz_id:d,eue_id:l,events:a,eu_info_id:u.euId,rel_ver:window.zRelVer,handshake_status:window.iszHandshakeDone,ip:t.ip,deviceName:"",screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,userAgent:window.navigator.userAgent,timeZone:f},g=t.perfUrl+"/perf";return window.isDataSyncInProgress=!0,ye()?Promise.resolve(pe(g,p,t.failureRetryCount)).then(function(e){if(e)return window.perfLastSyncTime=Date.now(),t=o,window.zEventsPerfData&&Array.isArray(window.zEventsPerfData)?window.zEventsPerfData.splice(0,t):window.zEventsPerfData=[],window.isDataSyncInProgress=!1,n=!0;var t}):(n=1,!1)}}();return Promise.resolve(i&&i.then?i.then(function(e){return!n||e}):!n||i)}catch(e){return Promise.reject(e)}},Ae=function(e){try{var n,t=F(),r=window.zEventsData||[];C("Data Length for direct streaming ");var o="";try{o=JSON.stringify(r)}catch(e){N("Failed to stringify zEvents")}var i=null!=t&&t.eventCountCapInSingleChunk?t.eventCountCapInSingleChunk:0,s=i>0&&r.length>i?i:r.length;I("Going to send data with chunk "+s+" total events count "+r.length+" chunk size "+i);var a=function(){if(2*o.length>=t.bufferSizeFrequency||window.lastSyncTime+t.timeFrequency<=Date.now()&&s>0){var i,a,c=r.slice(0,s),u=me()||{},d=ke()||{},l=ie("zId"),f=null!=(i=d.zExternalUserInfo)&&i.externalId?null==(a=d.zExternalUserInfo)?void 0:a.externalId:"",p=/\((.*)\)/.exec((new Date).toString())[1],g=Se(),v={key:e,sdk_ver:S.sdkVersion,src:"Frontend",s_id:u.sessionId,euz_id:l,eue_id:f,events:c,eu_info_id:d.euId,rel_ver:window.zRelVer,handshake_status:window.iszHandshakeDone,ip:t.ip,deviceName:"",screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,userAgent:window.navigator.userAgent,timeZone:p,pack:g},y="";try{y=JSON.stringify(v)}catch(e){N("Failed to stringify zipyDataJson")}var w={eventData:y};return Promise.resolve(function(e){try{ye()&&"false"===ie("is-api-key-valid")&&we(!1);var n=function(){if("isActive"in(n=me()||{})&&!n.isActive&&ye())return I("Going to register new session"),Promise.resolve(function(e){try{var n={v:S.sdkVersion},t=me(),r={enduser_session_id:t.sessionId,user_agent:window.navigator.userAgent,ip_address:"",location:"",enduser_zipy_id:"",project_release_version:"",sdk_version:"",device_name:"",screen_width:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,screen_height:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};return Promise.resolve(fe(S.registerSessionUrl+"/"+e,S.streamMgrRetryCount,n,r)).then(function(n){return n?(function(){var e=me();if(!e)return!1;try{return I("Setting session as active"+JSON.stringify(e)),e.isActive=!0,se("session-data",JSON.stringify(e)),!0}catch(e){return N("Failed to stringify  session data"),!1}}(),Ge(n,e),!0):(N("Not able to register new session for session Id : "+t.sessionId),!1)})}catch(e){return Promise.reject(e)}}(e)).then(function(){});var n}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(e)).then(function(){if(je())return function(){for(;window.zEventsData.length;)window.zEventsData.pop();window.zEventsData=[]}(),n=!0;var e={session_id:u.dSession,event_id:"AruZ~Em0WNlAnbyzVmwM~GR0cMb6Xl9r",is_new_party:u.isNewSession,is_new_session:u.isNewSession,client_timestamp_iso:(new Date).toISOString(),event_type:"MyEventRecord",parameters:w},r=t.streamUrl+"?p="+u.dSession;return window.isDataSyncInProgress=!0,ye()?Promise.resolve(ge({divolteUrl:r,divolteJson:e,failureRetryCount:t.failureRetryCount})).then(function(e){if(e){if(window.lastSyncTime=Date.now(),function(e){window.zEventsData&&Array.isArray(window.zEventsData)?window.zEventsData.splice(0,e):window.zEventsData=[]}(s),window.isDataSyncInProgress=!1,se("last-activity-time",window.zlastActivityTime),se("zenduser-last-activity-time",window.zenduserLastActivityTime),u.isNewSession){var t=me();if(t){t.isNewSession=!1;try{se("session-data",JSON.stringify(t))}catch(e){N("Failed to set session-data in localstorage")}}}return n=!0}}):(se("last-activity-time",window.zlastActivityTime),se("zenduser-last-activity-time",window.zenduserLastActivityTime),window.isDataSyncInProgress=!1,n=1,!1)})}}();return Promise.resolve(a&&a.then?a.then(function(e){return!n||e}):!n||a)}catch(e){return Promise.reject(e)}};function _e(e,t){void 0===e&&(e=A.inputMasking),C("Going to init rrweb Recorder"),window.zrrwebRecorderStatus=c.RECORDINGPENDING;var o,i=function(){};try{var s=F();i=n.record({emit:function(e,t){if(!K()){var o=-1;e.type!=n.EventType.IncrementalSnapshot?o=r.ReplayerEvent:(o=e.data.source?e.data.source:r.ReplayerEvent,(s.startCaptureWithoutUserActivity||o>=r.MouseInteraction&&o<=r.MediaInteraction)&&(window.zrrwebRecorderStatus=c.RECORDINGSUCCESSFUL,window.zenduserLastActivityTime=Date.now()));try{var i=!1;window.reinitializationInProgress||(i=Se());var a={data:i?n.pack(e):JSON.stringify(e),time:e.timestamp,type:o,isError:!1,navigatedUrl:window.location.origin+window.location.pathname};t&&e.type==n.EventType.Meta?(k("Checkout flow is triggered. Meta event expected type - "+n.EventType.Meta+" actual event "+e.type),a.isCheckout=t):t&&k("Full snapshot event. Expected event type - "+n.EventType.FullSnapshot+" Event type "+e.type),Me(a)}catch(e){N("Failed to store rrweb recorder events")}}},recordCanvas:M("canvasCapture"),blockClass:(o=M("blockClasses"),o&&"string"==typeof o?new RegExp(o):o instanceof RegExp?o:/zipy-block/),ignoreClass:"zipy-ignore",maskAllInputs:e,sampling:{mousemove:150,scroll:150,mouseInteraction:{MouseUp:!0,MouseDown:!0,Click:!0,ContextMenu:!1,DblClick:!0,Focus:!1,Blur:!1,TouchStart:!0,TouchEnd:!0}},userTriggeredOnInput:!0,recordCrossOriginIframes:M("recordCrossOriginIframes")||A.recordCrossOriginIframes})}catch(e){N(e)}return i}function Fe(e){return C("Going to init zipy Recorder"),function(e){void 0===e&&(e={});var n=e.emit;if(!n)return N("emit function is required to record data from zipy-event-recorder"),function(){};$=function(e){n(e)};try{var t=[];t.push(function(e){var n=location.href,t={navigatedUrl:window.location.href};e(_({eventType:r.NAVIGATION,data:t,isError:!1}));var o=window.history.pushState,i=window.history.replaceState;function s(){try{var t={navigatedUrl:window.location.href};n!=t.navigatedUrl&&(e(_({eventType:r.NAVIGATION,data:t,isError:!1})),n=t.navigatedUrl)}catch(e){N("not able to capture the navigation url")}}return window.history.pushState=function(){o.apply(window.history,arguments),window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange"))},window.history.replaceState=function(){i.apply(window.history,arguments),window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange"))},window.addEventListener("locationchange",s,!1),window.addEventListener("popstate",s),window.addEventListener("hashchange",s),function(){history.pushState=o,history.replaceState=i,window.removeEventListener("locationchange",s),window.removeEventListener("popstate",s),window.removeEventListener("hashchange",s)}}($));var i=F();return I("In zipy-event-record "+JSON.stringify(i)),i.consoleCapture&&t.push(function(e){function n(e){var n="";if("string"!=typeof e)try{n=JSON.stringify(e)}catch(e){}else n=e;try{if(-1!=n.search(u)||-1!=n.search(d))return!0}catch(e){return!0}return!1}function t(n,t){try{var o;o=function(e){if(!Array.isArray(e))return"";for(var n,t=[],r=U(e);!(n=r()).done;){var o=n.value;try{o&&"object"==typeof o?o.constructor.name.toLowerCase().includes("error")?t.push(String(o)):t.push(JSON.stringify(o)):t.push(String(o))}catch(e){t.push("[console log value cannot be serialized]")}}return t.join(" ")}(Array.from(t));var i=n==r.ConsoleError,s=i?function(e){if(!Array.isArray(e))return{hasErrorObj:!1};for(var n,t=U(e);!(n=t()).done;){var r=n.value;try{if(r&&"object"==typeof r&&r.constructor.name.toLowerCase().includes("error"))return{hasErrorObj:!0,errObj:r}}catch(e){N("Error in checking error argument. Error is - "+e.message)}}return{hasErrorObj:!1}}(Array.from(t)):{hasErrorObj:!1};if(function(e,n){if(null==e)return!1;var t,r=e.toLowerCase(),o=F();try{t=n?o.isIgnoreConsoleError:o.ignoreConsole}catch(e){N(e)}try{if(t.some(function(e){return r.includes(e.toLowerCase())}))return!0}catch(e){return!1}return!1}(o,i))return;if(i&&s.hasErrorObj){var a={message:o,error:s.errObj.stack,filename:"",colno:0,lineno:0};e(_({eventType:X(o,r.Error),data:a,isError:!0}))}else e(_({eventType:n,data:{arguments:o,argumentsObj:J(Array.from(t))},isError:i}))}catch(e){return void N("Error in parsing console log. Error is: "+e.message)}}try{var o,i,s,a,c;c=F().consoleLogLevel.split(",");try{c.includes(l.ERROR)&&(o=console.error.bind(console),console.error=function(){n(arguments[0])||t(r.ConsoleError,arguments),o.apply(console,arguments)})}catch(e){N("Error in parsing console error. Error is: "+e.message)}try{c.includes(l.LOG)&&(i=console.log.bind(console),console.log=function(){n(arguments[0])||t(r.ConsoleInfo,arguments),i.apply(console,arguments)})}catch(e){N("Error in parsing console log. Error is: "+e.message)}try{c.includes(l.WARNING)&&(s=console.warn.bind(console),console.warn=function(){n(arguments[0])||t(r.ConsoleWarning,arguments),s.apply(console,arguments)})}catch(e){N("Error in parsing console warning. Error is: "+e.message)}try{c.includes(l.DEBUG)&&(a=console.debug.bind(console),console.debug=function(){n(arguments[0])||t(r.ConsoleDebug,arguments),a.apply(console,arguments)})}catch(e){N("Error in parsing console debug. Error is: "+e.message)}return function(){o&&(console.error=o),i&&(console.log=i),s&&(console.warn=s),a&&(console.debug=a)}}catch(e){return N("Error while getting console log level from sdk config. Error is: "+e.message),function(){}}}($)),i.stackTraceCapture&&t.push(function(e){var n=[x("error",function(n){!function(e,n){var t=e.message,o=e.filename,i=e.lineno,s=e.colno;if(W(t)||W(o))C("Ignoring error from error callback "+t);else if(e.error){var a,c,u;if(W(null==(a=e.error)?void 0:a.stack))return void C("Ignoring error from error callback "+(null==(u=e.error)?void 0:u.stack));var d,l=null==(c=e.error)?void 0:c.stack;try{d="string"!=typeof l?JSON.stringify(l):l}catch(e){N("Failed to stringfy errorMsg inside error callback with exception"+e)}var f={message:t,filename:o,lineno:i,colno:s,error:d};n(_({eventType:X(t,r.Error),data:f,isError:!0}))}else{if((null==t||""==t)&&S.ignoreEmptyErros)return void C("Ignored empty error");var p={message:t,filename:o,lineno:i,colno:s,error:""};n(_({eventType:X(t,r.Error),data:p,isError:!0}))}}(n,e)},window)];return n.push(x("unhandledrejection",function(n){var t,o="reason"in n?null==n?void 0:n.reason:n,i=null!=n&&n.reason.stack?n.reason.stack:n;try{t="string"!=typeof i?JSON.stringify(i):i}catch(n){N("Failed to stringfy errorMsg inside unhandledrejection callback with exception"+n)}var s={message:""+o,error:t,filename:"",colno:0,lineno:0};if(null!=o&&""!=o||""!=s.error&&null!=s.error||!S.ignoreEmptyErros){var a="";try{a=JSON.stringify(s.error)}catch(n){N("Failed to stringfy exception")}W(s.message)||W(a)?C("Ignoring error from unhandled "+o):e(_({eventType:X(o,r.UnhandledRejection),data:s,isError:!0}))}else C("Ignoring empty errors")},window)),function(){n.forEach(function(e){return e()})}}($)),i.networkCapture&&(t.push(function(e){var n=0;function t(e,t){if(M("networkCapture")&&!window.stopRecording&&!ee(t.requestUrl,t.status,t.status>=400)){t.requestUrl=function(e){try{var n=new URL(e);if(e){var t=new URLSearchParams(new URL(e).search);t.forEach(function(e,n){Z.includes(n.toLowerCase())&&t.set(n,"xxx")}),n.search=t.toString()}return n.toString()}catch(n){return N("updateQueryStringFromRequestUrl: ERROR WHILE HIDING QUERY PARAM VALUE: "+n),e}}(t.requestUrl);var r=F();if(r&&r.isApiIdentifierEnable&&r.apiUniqueIdentifier.length>0){var o=r.apiUniqueIdentifier.filter(function(e){return e.apiUrl===t.requestUrl});o.length>0&&(t.apiIdentifier=function(e,n){try{var t=JSON.parse(e);if(t&&"object"==typeof t)for(var r=Object.keys(t),o=0,i=r;o<i.length;o++){var s=i[o];if(s===n)return"string"==typeof t[s]?t[s]:""}}catch(e){N("error while parsing api payload: "+e)}return""}(t.request,o[0].identifierName))}t=H(t,n,t.requestByteSize||0,!0),I("Pushing fetch Data when performance is enabled "+(t=H(t,n,t.responseByteSize||0,!1)).requestUrl),window.zFetchTempData.push({eventType:e,data:t,isError:t.status>=400})}}function o(e,n){if("GET"==n||"get"==n)try{var t=e.split("/"),r=t[t.length-1];if(""==r&&t.length>=2&&(r=t[t.length-2]),-1!=r.indexOf(".js")&&!r.indexOf(".json")||-1!=r.indexOf(".map")||-1!=r.indexOf(".html")||-1!=r.indexOf(".css"))return I("Going to ignore response text for url "+e),!0}catch(e){return!1}return!1}if(null!=window.zxhrInit||1==window.zxhrInit)return I("Network in already initialized"),function(){};var i=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){var e="";null!=arguments[1]&&null!=arguments[1]&&("string"==typeof arguments[1]?e=arguments[1]:arguments[1]instanceof URL&&(e=arguments[1].href));var n,s,a={request:"",requestMethod:arguments[0]?arguments[0]:"",requestUrl:e,sourceLibrary:"xmlHttpClient",headers:{},response:"",responseHeaders:{},status:400,requestStartTime:0,duration:0,requestByteSize:0,responseByteSize:0},c=this.send;this.send=function(){a.requestStartTime=Date.now(),a.request=arguments[0]?arguments[0]:"",a=H(a,0,0,!0),c.apply(this,arguments)};var u=this.setRequestHeader;this.setRequestHeader=function(){var e,n;2!==arguments.length||(e=arguments[0],(n=j()).length>0&&n.indexOf(e)>-1)||(a.headers[arguments[0]]=arguments[1]),u.apply(this,arguments)},this.addEventListener("load",function(){try{var i=function(){a.status=c.status,a.duration=n-a.requestStartTime,t(r.XHR,a)},c=this;n=Date.now();var u=function(){if(!o(e,a.requestMethod)){var n=function(e,n){try{var t=function(){function e(){a.responseByteSize=t,a.response=s,a=H(a,0,t,!1)}var n=c.getAllResponseHeaders().split("\n"),t=0;n.forEach(function(e){if(""!==e){var n=e.split(":");a.responseHeaders[n[0]]=n[1].trim(),!t&&n[0]&&"content-length"==n[0].toLowerCase()&&(t=n[1].trim())}});var r=function(){var e;if("blob"===(null==c?void 0:c.responseType))return t=t||(null==c||null==(e=c.response)?void 0:e.size),Promise.resolve(new Response(null==c?void 0:c.response).text()).then(function(e){s=e});s=null!=c&&c.responseText?c.responseText:"",t=t||s.length}();return r&&r.then?r.then(e):e()}()}catch(e){return n()}return t&&t.then?t.then(void 0,n):t}(0,function(){C("Error while capturing response text")});if(n&&n.then)return n.then(function(){})}}();return Promise.resolve(u&&u.then?u.then(i):i())}catch(e){return Promise.reject(e)}}),this.addEventListener("error",function(){try{n=Date.now();var e=this.getAllResponseHeaders().split("\n"),o=0;e.forEach(function(e){if(""!==e){var n=e.split(":");a.responseHeaders[n[0]]=n[1].trim(),!o&&n[0]&&"content-length"==n[0].toLowerCase()&&(o=n[1].trim())}});var i=M("responseCapSize")||1e6,s=M("sizeExceededMessage");(o=o||(null==this?void 0:this.responseText.length))&&o<=i?a.response=null!=this&&this.responseText?this.responseText:"":o>0&&(a.response=s),a.responseByteSize=o||0}catch(e){C("Error while capturing response text")}a.status=this.status?this.status:404,t(r.XHR,a)}),this.addEventListener("abort",function(){I("Request got aborted in fetch")}),i.apply(this,arguments)};var s=window.fetch;return window.fetch=function(){var e,n,i,a,c="",u={sourceLibrary:"fetch",requestUrl:"",requestMethod:"",headers:"",request:"",response:"",responseHeaders:{},status:400,requestStartTime:0,duration:0,requestByteSize:0,responseByteSize:0};u.requestStartTime=Date.now(),null!=arguments[0]&&null!=arguments[0]&&(c="string"==typeof(e=arguments[0])?e:e?e instanceof URL?e.href:e instanceof Request?e.url:"":"");try{if(null!=arguments[1]&&null!=arguments[1]){var d=arguments[1].body;d&&(u.requestByteSize=JSON.stringify(d,null,4).length)}}catch(e){N("error while capturing data length")}try{arguments[1]&&arguments[1].headers&&(n=R({},arguments[1].headers))}catch(e){N("header is not present in the call")}u=H(u={sourceLibrary:"fetch",requestUrl:c||"",requestMethod:arguments[1]&&arguments[1].method?arguments[1].method:"GET",headers:n?(i=n,a=j(),a.length>0?(a.forEach(function(e){return delete i[e]}),i):i):"",request:arguments[1]&&arguments[1].body?arguments[1].body:"",response:"",responseHeaders:{},status:400,duration:0,requestByteSize:0,responseByteSize:0,requestStartTime:u.requestStartTime},0,0,!0);var l=s.apply(window,arguments);return new Promise(function(e,n){var i={status:400},s=0;l.then(function(n){i={status:n.status};for(var t,r=U(n.headers);!(t=r()).done;){var o=t.value;o&&(u.responseHeaders[o[0]]=o[1],!s&&o[0]&&"content-length"==o[0].toLowerCase()&&(s=o[1]))}return e(n.clone()),V(n)}).then(function(e){var n=Date.now(),a=M("xhrRespPayloadCapture");(!o(c,u.requestMethod)&&i.status>=400||a)&&(u.response=e,u=H(u,0,s,!1)),u.duration=n-u.requestStartTime,u.status=i.status,t(r.XHR,u)}).catch(function(e){N("Error in fetch response: "+e.message),n(e)})})},window.zxhrInit=!0,function(){}}()),t.push(function(e){var n=[x("online",function(n){re(e)},window)];return n.push(x("offline",function(n){re(e)},window)),function(){n.forEach(function(e){return e()})}}($))),t.push(function(e){var n=[];return n.push(x(g,function(n){try{var t=null==n?void 0:n.detail,o=t.message,i=t.options,s=void 0===i?{}:i;C("Capturing log message for message : "+o+" options: "+JSON.stringify(s)),o&&s&&s.constructor===Object?e(_({eventType:r.ZipyLogMessage,data:{message:o.length<w?o:o.substring(0,w),options:s},isError:!1})):I("Didn't capture log message for message : "+o+" options: "+JSON.stringify(s))}catch(e){N("Error in capturing log message. Error is - "+e.message)}},window)),n.push(x(v,function(n){try{var t,o=(null==(t=n.detail)?void 0:t.error)||{},i=o.message,s=o.name,a=void 0===s?"":s,c=o.filename,u=void 0===c?"":c,d=o.lineno,l=void 0===d?0:d,f=o.colno,p=void 0===f?0:f,g=o.cause,v=void 0===g?"":g,y=o.stack,w=void 0===y?"":y;if(v=v?String(v):"",C("Capturing exception message for message : "+i+" name: "+a+" stack: "+w),W(i)||W(a))return void C("Ignoring exception logs for message: "+i);i?e(_({eventType:r.ZipyLogException,data:{message:i,name:a,filename:u,lineno:l,colno:p,cause:v,stack:w},isError:!0})):I("Didn't capture exception message for message : "+i+" name: "+a)}catch(e){N("Error in capturing log message. Error is - "+e.message)}},window)),n.push(x(y,function(n){try{var t=null==n?void 0:n.detail,o=t.name,i=t.message,s=void 0===i?"":i,a=t.category,c=void 0===a?"FE":a,u=t.options,d=void 0===u?{}:u;if(C("Capturing exception message for message : "+s+" name: "+o),W(s)||W(o))return void C("Ignoring error logs for message: "+s);s&&o&&d&&d.constructor===Object?e(_({eventType:"NE"===c?r.ZipyLogNetworkError:r.ZipyLogFrontendError,data:{message:s.length<w?s:s.substring(0,w),name:o,category:c,options:d},isError:!0})):I("Didn't capture error message for message : "+s+" name: "+o+" category:"+c+" options: "+JSON.stringify(d))}catch(e){N("Error in capturing log message. Error is - "+e.message)}},window)),function(){n.forEach(function(e){return e()})}}($)),t.push(function(e){if(window.PerformanceObserver&&"function"==typeof window.PerformanceObserver){var n=new PerformanceObserver(function(n){var t=n.getEntries();I("perf event size is - "+t.length),N("Perf entires"),N(t.filter(function(e){return"fetch"==e.initiatorType||"xmlhttprequest"==e.initiatorType}));for(var o,i=U(t);!(o=i()).done;){var s=o.value;try{var a=Y(s.initiatorType);if(a===r.XHR&&window.zFetchTempData&&window.zFetchTempData.length>0)for(var c=[].concat(window.zFetchTempData)||[],u=function(n){var t;N("Compare tempData[j].data?.requestUrl {} and entries[i].name"),I("Merging XHR calls");var o=(null==(t=c[n].data)?void 0:t.requestUrl)||"",i=s.name||"";if(i&&o&&decodeURIComponent(o)===decodeURIComponent(i)||te(o,i)){var a,u,d,l;I("INSIDE :: Compare xhrUrl "+o+" and perfURL "+i);var f=ne(s);f.responseStatus=s.responseStatus?s.responseStatus:null==(a=c[n].data)?void 0:a.status,f.transferSize=s.transferSize?s.transferSize:null==(u=c[n].data)?void 0:u.responseByteSize,f.apiIdentifier=(null==(d=c[n].data)?void 0:d.apiIdentifier)||"",o.indexOf("http://")>-1||o.indexOf("https://")>-1||(c[n].data.requestUrl=i);var p=R({},c[n].data,f);return c[n]=R({},c[n],{data:p}),I("Merged XHR calls is "+c[n]),e(_({eventType:r.Performance,data:R({},f,{method:null==(l=c[n].data)?void 0:l.requestMethod}),isError:f.responseStatus>=400})),e(_(c[n])),I("Old temp XHR data calls length "+window.zFetchTempData.length),window.zFetchTempData=window.zFetchTempData.filter(function(e,t){return t!=n}),I("New temp XHR data calls length "+window.zFetchTempData.length),"break"}},d=0;d<c.length&&"break"!==u(d);d++);else if(a&&a!=r.XHR){var l=ne(s),f=l.responseStatus>=400;ee(s.name,s.responseStatus,f)||e(_({eventType:r.Performance,data:R({},l,{method:"GET"}),isError:f}))}else N("XHR request but zFetchTempData is empty. API: "+s.name+", Event type: "+a+". Initiator type - "+s.initiatorType)}catch(e){N("Error in capturing perf data. Error is - "+e.message)}}});return n.observe({entryTypes:["resource"]}),function(){return n.disconnect()}}return function(){}}($)),t.push(function(e){var n=performance.getEntriesByType("resource").filter(function(e){return Q.indexOf(e.initiatorType)>-1});C("Inside initial perf event function. Size of data is - "+n.length);for(var t,o=U(n);!(t=o()).done;){var i=t.value;if(!ee(i.name,i.responseStatus,i.responseStatus>=400)){var s=ne(i);e(_({eventType:r.Performance,data:R({},s,{method:"GET"}),isError:(null==s?void 0:s.responseStatus)>=400}))}}return function(){}}($)),i.webSocketsCapture&&(k("Going to init websockets",window),window.sdkInit?function(){if(k("Start recording"),window._websockets&&window._websockets.length)for(var e=0;e<window._websockets.length;e++)window._websockets[e]&&window._websockets[e].zRecordStart&&"function"==typeof window._websockets[e].zRecordStart&&(window._websockets[e].zRecordStart(),k("Zipy Recording Status:"))}():function(e){function n(n,t){window.stopRecording||e(_({eventType:n,data:t,isError:n==r.WSERROR}))}function t(e){k("onmessage: ");var t={data:e.data,type:e.type,wsTimestamp:e.timeStamp},i={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:o.MESSAGERECEIVED};i.responseData=t,n(r.WSMESSAGE,i)}function i(e){k("onclose: ");var t=window._websockets.indexOf(this.ws);t>-1&&window._websockets.splice(t,1);var i={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:o.SOCKETCLOSE};i.responseData={code:e.code,reason:e.reason,type:e.type,wsTimestamp:e.timeStamp},n(r.WSCLOSE,i)}function s(e){k("onopen: ");var t={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:o.SOCKETERROR};n(r.WSOPEN,t)}function a(e){k("onerror: ");var t={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:o.SOCKETERROR};t.responseData={code:e.code,reason:e.reason,type:e.type,wsTimestamp:e.timeStamp},n(r.WSERROR,t)}k("Inside captureWebSocketRequest"),k("Going to call WebSocket connection");var c=new Proxy(window.WebSocket,{construct:function(e,c){k("WebSocket connection");var u=b(e,c),d=t,l=i,f=s,p=a,g=u.send;return u.zRecordStatus="initiated",u.zRecordStart=function(){"started"!==u.zRecordStatus&&(function(e){var t=e.send;e.send=function(e){k("onsend");var i={requestUrl:this.url?this.url:"",status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,requestData:arguments[0]?arguments[0]:"",timestamp:Date.now(),wsMsgType:o.MESSAGESEND};t.apply(this,[e]),n(r.WSMESSAGE,i)}}(u),u.addEventListener("message",d),u.addEventListener("open",f),u.addEventListener("error",p),u.addEventListener("close",l),u.zRecordStatus="started")},u.zRecordStop=function(){"stopped"!==u.zRecordStatus&&(u.send=g,u.removeEventListener("message",d),u.removeEventListener("open",f),u.removeEventListener("error",p),u.removeEventListener("close",l),u.zRecordStatus="stopped")},window._websockets=window._websockets||[],window._websockets.push(u),window.stopRecording||u.zRecordStart(),u}});k("Going to set WebSocket connection"),window.WebSocket=c}($)),function(){t.forEach(function(e){return e()}),function(){if(k("Stop recording"),window._websockets&&window._websockets.length)for(var e=0;e<window._websockets.length;e++)window._websockets[e]&&window._websockets[e].zRecordStop&&"function"==typeof window._websockets[e].zRecordStop&&(window._websockets[e].zRecordStop(),k("Zipy Recording Status:"))}()}}catch(e){return N(e),function(){}}}({emit:function(e){try{var n=F();if(e.eventType!=r.Online||window.iszHandshakeDone||(window.ztryForHandshake=!0),window.iszSessionExpired)return void C("Don't store zipy events if session is expired");(n.startCaptureWithoutUserActivity||e.eventType>=r.Error&&e.eventType<=r.UnhandledRejection)&&(window.zrrwebRecorderStatus=c.RECORDINGSUCCESSFUL);var t,o={data:JSON.stringify(e.data),time:e.timestamp,type:e.eventType===r.Performance?Y(e.data.initiatorType):e.eventType,isError:e.isError,navigatedUrl:window.location.origin+window.location.pathname};o.type===r.XHR&&e.eventType==r.Performance||Me(o),n.capturePerformance&&r.Performance===e.eventType&&function(e){var n=F();window.zrecordingPaused||je()&&!he(n)||ye()&&window.zEventsPerfData.push(e)}({data:e.data,type:null==(t=e.data)?void 0:t.initiatorType,time:e.timestamp})}catch(e){N("Failed to store events")}}})}function Me(e){var n=F();window.zrecordingPaused||je()&&!he(n)||ye()&&window.zEventsData.push(e),window.zlastActivityTime=Date.now()}var qe=function(e){var n,t,r={domCapture:"boolean"==typeof(null==e?void 0:e.dom_capture)?null==e?void 0:e.dom_capture:A.domCapture,consoleCapture:"boolean"==typeof(null==e?void 0:e.console_capture)?null==e?void 0:e.console_capture:A.consoleCapture,networkCapture:"boolean"==typeof(null==e?void 0:e.network_capture)?null==e?void 0:e.network_capture:A.networkCapture,stackTraceCapture:"boolean"==typeof(null==e?void 0:e.stack_trace_capture)?null==e?void 0:e.stack_trace_capture:A.stackTraceCapture,webSocketsCapture:"boolean"==typeof(null==e?void 0:e.web_sockets_capture)?null==e?void 0:e.web_sockets_capture:A.webSocketsCapture,ipCapture:"boolean"==typeof(null==e?void 0:e.ip_capture)?null==e?void 0:e.ip_capture:A.ipCapture,inputMasking:"boolean"==typeof(null==e?void 0:e.input_masking)?null==e?void 0:e.input_masking:A.inputMasking,textMasking:"boolean"==typeof(null==e?void 0:e.text_masking)?null==e?void 0:e.text_masking:A.textMasking,paid:"boolean"==typeof(null==e?void 0:e.paid)?null==e?void 0:e.paid:A.paid,apiKey:null==e?void 0:e.api_key,streamUrl:null!=e&&e.stream_url?null==e?void 0:e.stream_url:A.streamUrl,maxBufferSize:null!=e&&e.max_buffer_size?1024*(null==e?void 0:e.max_buffer_size):A.maxBufferSize,compression:"boolean"==typeof(null==e?void 0:e.compression)?null==e?void 0:e.compression:A.compression,compressionType:null!=e&&e.compression_type?null==e?void 0:e.compression_type:A.compressionType,timeFrequency:null!=e&&e.time_frequency?1e3*(null==e?void 0:e.time_frequency):A.timeFrequency,encodingType:null==e?void 0:e.encoding_type,sessionTimeout:null!=e&&e.session_timeout?1e3*(null==e?void 0:e.session_timeout):A.sessionTimeout,failureRetryCount:null!=e&&e.failure_retry_count?null==e?void 0:e.failure_retry_count:A.failureRetryCount,bufferSizeFrequency:null!=e&&e.buffer_size_frequency?1024*(null==e?void 0:e.buffer_size_frequency):A.bufferSizeFrequency,ignoreUrl:null!=e&&e.ignoreUrl?null==e?void 0:e.ignoreUrl:A.ignoreUrl,ignoreError:null!=e&&e.ignoreError?null==e?void 0:e.ignoreError:A.ignoreError,ignoreConsole:null!=e&&e.ignoreConsole?null==e?void 0:e.ignoreConsole:A.ignoreConsole,isIgnoreUrlError:null!=e&&e.isIgnoreUrlError?null==e?void 0:e.isIgnoreUrlError:A.isIgnoreUrlError,isIgnoreConsoleError:null!=e&&e.isIgnoreConsoleError?null==e?void 0:e.isIgnoreConsoleError:A.isIgnoreConsoleError,ip:null!=e&&e.ip?null==e?void 0:e.ip:"",pack:!(null==e||!e.pack||!e.pack),blockClasses:(n=null!=e&&e.blockClasses?null==e?void 0:e.blockClasses:A.blockClasses,t="zipy-block",n=(n=n&&n.length?n+(t?","+t:""):t).split(",").filter(q).map(G).join("|"),new RegExp(n)),customerId:null==e?void 0:e.cId,headersToSanitize:null!=e&&e.headersToSanitize?e.headersToSanitize:"",xhrReqPayloadCapture:"boolean"==typeof(null==e?void 0:e.xhrReqPayloadCap)?null==e?void 0:e.xhrReqPayloadCap:A.xhrReqPayloadCapture,xhrRespPayloadCapture:"boolean"==typeof(null==e?void 0:e.xhrRespPayloadCap)?null==e?void 0:e.xhrRespPayloadCap:A.xhrRespPayloadCapture,canvasCapture:"boolean"==typeof(null==e?void 0:e.canvasCapture)?null==e?void 0:e.canvasCapture:A.canvasCapture,requestCapSize:null!=e&&e.requestCapSize?null==e?void 0:e.requestCapSize:A.requestCapSize,responseCapSize:null!=e&&e.responseCapSize?null==e?void 0:e.responseCapSize:A.responseCapSize,sizeExceededMessage:null!=e&&e.sizeExceededMessage?null==e?void 0:e.sizeExceededMessage:A.sizeExceededMessage,eventCountCapInSingleChunk:"number"==typeof(null==e?void 0:e.eventCountCapInSingleChunk)?e.eventCountCapInSingleChunk:A.eventCountCapInSingleChunk,captureCustomZipyLogMessage:"boolean"==typeof(null==e?void 0:e.captureCustomZipyLogMessage)?e.captureCustomZipyLogMessage:A.captureCustomZipyLogMessage,captureCustomZipyLogError:"boolean"==typeof(null==e?void 0:e.captureCustomZipyLogError)?e.captureCustomZipyLogError:A.captureCustomZipyLogError,captureCustomZipyLogException:"boolean"==typeof(null==e?void 0:e.captureCustomZipyLogException)?e.captureCustomZipyLogException:A.captureCustomZipyLogException,startCaptureWithoutUserActivity:"boolean"==typeof(null==e?void 0:e.startCaptureWithoutUserActivity)?e.startCaptureWithoutUserActivity:A.startCaptureWithoutUserActivity,consoleLogLevel:null!=e&&e.consoleLogLevel?e.consoleLogLevel:A.consoleLogLevel,recordCrossOriginIframes:A.recordCrossOriginIframes,splitSessionSize:"number"==typeof(null==e?void 0:e.splitSessionSize)?e.splitSessionSize:A.splitSessionSize,capturePerformance:"boolean"==typeof(null==e?void 0:e.capturePerformance)?e.capturePerformance:A.capturePerformance,perfUrl:null!=e&&e.perfUrl?null==e?void 0:e.perfUrl:A.perfUrl,perfTimeFrequency:"number"==typeof(null==e?void 0:e.perfTimeFrequency)?e.perfTimeFrequency:A.perfTimeFrequency,perfBufferSizeFrequency:"number"==typeof(null==e?void 0:e.perfBufferSizeFrequency)?e.perfBufferSizeFrequency:A.perfBufferSizeFrequency,isApiIdentifierEnable:"boolean"==typeof(null==e?void 0:e.isApiIdentifierEnable)?e.isApiIdentifierEnable:A.isApiIdentifierEnable,apiUniqueIdentifier:null!=e&&e.apiUniqueIdentifier&&Array.isArray(e.apiUniqueIdentifier)?e.apiUniqueIdentifier:A.apiUniqueIdentifier,ignoreUrlErrorCodes:null!=e&&e.ignoreUrlErrorCodes?e.ignoreUrlErrorCodes:A.ignoreUrlErrorCodes,ignoreUrlCodes:null!=e&&e.ignoreUrlCodes?e.ignoreUrlCodes:A.ignoreUrlCodes};return r.ignoreUrl.push(r.streamUrl.substring(r.streamUrl.indexOf("://")+3)),r.ignoreUrl.push(r.streamUrl.substring(r.perfUrl.indexOf("://")+3)),r.ignoreUrl.push(S.streamMgrUrl.substring(S.streamMgrUrl.indexOf("://")+3)),r.ignoreUrl.push("google.com"),r.isIgnoreUrlError.push(r.streamUrl.substring(r.streamUrl.indexOf("://")+3)),r.isIgnoreUrlError.push(S.streamMgrUrl.substring(S.streamMgrUrl.indexOf("://")+3)),r.isIgnoreUrlError.push("google.com"),function(e){if(e)try{var n;I("Updating zsdk-config"+JSON.stringify(e)),e.blockClasses=null==(n=e.blockClasses)?void 0:n.source,se("zsdk-config",JSON.stringify(e))}catch(e){N("Failed to stringify zsdk-config ")}}(r),r};function Ge(e,n){var t,r=(null==e?void 0:e.blocked_till)>0?null==e?void 0:e.blocked_till:0,o=r>0?D()+r:0;t={isBlocked:!(null==e||!e.is_blocked)&&(null==e?void 0:e.is_blocked),apiKey:n,blockedEndTime:o},window.zSessionBlockedInfo=t,function(e){if(e)try{I("Updating zsession-blocked-info"+JSON.stringify(e)),se("zsession-blocked-info",JSON.stringify(e))}catch(e){N("Failed to stringify zsession-blocked-info ")}}(t)}function je(){var e=window.zSessionBlockedInfo||{};return!(null==e||!e.isBlocked)&&e.isBlocked}function Je(e,n){try{for(var t,r=U(window.document.querySelectorAll("iframe"));!(t=r()).done;){var o=t.value;try{var i=new URL(o.src);if(n){if(i.origin!==window.document.location.origin&&o.contentWindow===(null==n?void 0:n.source))return C("sending message to iframe to start recording"),void o.contentWindow.postMessage({action:m,config:e},"*");continue}i.origin!==window.document.location.origin&&(C("sending message to iframe to start recording"),o.contentWindow.postMessage({action:m,config:e},"*"))}catch(e){N("failed to start recording for iframe:")}}}catch(e){N("failed to start recording")}}function Ze(){try{var e=window.document.querySelectorAll("iframe");C("going to stop iframe");for(var n,t=U(e);!(n=t()).done;){var r=n.value;try{new URL(r.src).origin!==window.document.location.origin&&(C("sending message to iframe to stop recording"),r.contentWindow.postMessage({action:h},"*"))}catch(e){N("failed to stop recording for iframe:")}}}catch(e){N("failed to stop recording")}}var Be=function(e){try{var n,t=function(t){if(n)return t;function o(){function n(n){function t(){function n(n){n&&C("Successfully sent pref data to server via session storage"),Ye(S.sdkLoopTime,e)}var t=!window.iszInternetDisconnected&&window.zrrwebRecorderStatus!=c.RECORDINGPENDING&&r.capturePerformance;return t?Promise.resolve(Le(e)).then(n):n(t)}var o=function(){if(n){var t=function(){C("Successfully send data to server via session storage")},o=function(){if(window.zrecordingPaused){window.zrecordingPaused=!1,window.reinitializationInProgress=!0;var n=s.GETUSERCONFIG;return De()&&(n=s.POSTENDUSERINFOANDGETUSERCONFIG),Promise.resolve(Pe(e,n,!1)).then(function(e){r=e,window.zStop=Xe()})}}();return o&&o.then?o.then(t):t()}var i=window.zEventsData||[],a="";try{a=JSON.stringify(i)}catch(e){N("Failed stringify events while stream data server")}0!=r.maxBufferSize&&2*a.length>r.maxBufferSize&&!window.zrecordingPaused&&(window.zrecordingPaused=!0,I("Max Buffer size is reached going to pause recording"))}();return o&&o.then?o.then(t):t()}var t=!window.iszInternetDisconnected&&window.zrrwebRecorderStatus!=c.RECORDINGPENDING;return t?Promise.resolve(Ae(e)).then(n):n(t)}var i=function(){if(window.ztryForHandshake)return Promise.resolve(Pe(e,window.zpendingOp,!1)).then(function(e){r=e})}();return i&&i.then?i.then(o):o()};if(0==window.sdkInit)return I("Sdk is not initialized yet"),Ye(S.sdkLoopTime,e),Promise.resolve();if(window.isDataSyncInProgress)return C("Data sync in in progress"),Ye(S.sdkLoopTime,e),Promise.resolve();if(window.reinitializationInProgress)return C("Reinit is in progress"),Ye(S.sdkLoopTime,e),Promise.resolve();var r=F(),o=function(){if(he(r)&&window.zEventsData&&window.zEventsData.length>0&&!window.iszInternetDisconnected&&window.zrrwebRecorderStatus!=c.RECORDINGPENDING){I("Session is expired Going to recreate session"),window.reinitializationInProgress=!0,ze(e);var t=s.GETUSERCONFIG;return De()&&(t=s.POSTENDUSERINFOANDGETUSERCONFIG),Promise.resolve(Pe(e,t,!0)).then(function(t){r=t,window.zrecordingPaused=!1,window.zStop=Xe(),Ye(S.sdkLoopTime,e),n=1})}}();return Promise.resolve(o&&o.then?o.then(t):t(o))}catch(e){return Promise.reject(e)}},He=5,We=function(e,n){void 0===n&&(n={releaseVer:""});try{return Promise.resolve(function(t,r){try{var o=function(){if(z=S.debugLogs,K()){if(function(){try{return window.top.window.zipy?(C("Zipy is present in parent"),!0):(C("Zipy is not present in parent"),!1)}catch(e){return N("Error in is same origin method. Error - "+(e?e.message:e)),!1}}())return void I("Not initializing sdk as function is called inside iframe.");if(!function(e){var n=null;try{var t,r,o,i=null==e||null==(t=e.window)||null==(r=t.top)?void 0:r.document;n=null==i||null==(o=i.body)?void 0:o.innerHTML}catch(e){C("iframe is cross-domain")}return null!==n}(window.self)&&A&&A.recordCrossOriginIframes){window.recordingStatus||(window.recordingStatus=!1);try{window.onload=function(){C("Iframe content loaded!"),window.parent.postMessage({action:E},"*")}}catch(e){N("not able to notify about iframe content loaded event:")}var t=e;try{I("init: We will start recording cross-origin iframe now!"),function(e,n){window.addEventListener("message",function(t){try{var r,o,i;(null==t||null==(r=t.data)?void 0:r.action)===m&&(null==t||null==(o=t.data)||null==(i=o.config)?void 0:i.apiKey)==e&&!0!==window.recordingStatus&&(C("going to init iframe recording"),n.push(_e(t.data.config.inputMasking)),window.sdkConfig=t.data.config,window.recordingStatus=!0)}catch(e){N("cannot start recording for iframe:")}try{var s;(null==t||null==(s=t.data)?void 0:s.action)==h&&!1!==window.recordingStatus&&(C("going to stop recording for iframe"),window.stopRecording=!0,n.forEach(function(e){return e()}),window.recordingStatus=!1)}catch(e){N("failed to stop iframe recording:")}})}(t,[])}catch(e){N(e.message)}return}}var r=new RegExp(/^[a-zA-Z0-9]{8}$/);if(e&&r.test(e))return window.zRelVer=n.releaseVer,function(){try{for(var e=Object.keys(localStorage),n=0;n<e.length;n++)["zsession-blocked-info","session-data","zId","zenduser-info-temp","zenduser-info","last-activity-time","pack","zsdk-config","is-api-key-valid","zenduser-last-activity-time","ztotal-data-sent"].includes(e[n])&&(oe.set(e[n],localStorage.getItem(e[n])),I("updated value in map is :"+oe.get(e[n])))}catch(e){N("inside zLocalStorgeMapUpdate catch block ${e.message}")}}(),Promise.resolve(function(e,n){var t=[];try{for(window.sdkInit=!1,window.isDataSyncInProgress=!1,window.zEventsData=[],window.zEventsPerfData=[],window.zFetchTempData=[],window.iszInternetDisconnected=!1,window.zlastActivityTime=Date.now(),window.zenduserLastActivityTime=Ee(),window.zenduserLastActivityTime||(window.zenduserLastActivityTime=Date.now()),window.zrecordingPaused=!1,window.ztryForHandshake=!1,window.iszSessionExpired=!1,window.zrrwebRecorderStatus=c.NORECORDING;window.zEventsData.length;)window.zEventsData.pop();var r=window.sessionStorage.getItem("pending-zEvents");if(I("pendingEvents value is"+r),r)try{var o;o=JSON.parse(r),window.zEventsData=o}catch(e){N("Failed to parse zipyEvents")}var i=de();i&&i.apiKey==e||ue(e),C("Zipy Recorder init"),Ie(e)&&(ke()?(I("Removing enduser-info"),ae("zenduser-info")):I("zenduser Data dosen't exists"),be());var u=s.GETUSERCONFIG;if(!ke()&&!Ne()){u=s.POSTENDUSERINFOANDGETUSERCONFIG;var d=Ce(),l={euId:0,euZName:"",userType:a.ANONYMS,isBlocked:!1,zExternalUserInfo:n&&n.uniqueUserId?xe(n):{},zAnonymsUserInfo:{zId:d,euId:0,euZName:""}};Oe(l),Re(l)}De()&&(u=s.POSTENDUSERINFOANDGETUSERCONFIG);var f=!1;(he(ce()||{})||Ie(e))&&(ze(e),f=!0),Pe(e,u,f).then(function(e){if(window.lastSyncTime=0,window.perfLastSyncTime=0,e.domCapture){var n=_e(e.inputMasking);t.push(n)}t.push(Fe());try{window.addEventListener("message",function(n){var t;(null==n||null==(t=n.data)?void 0:t.action)===E&&!0!==window.stopRecording&&Je(e,n)})}catch(e){N("failed to start recording for iframe content loaded event")}Je(e),window.zStop=function(){try{window.stopRecording=!0,t.forEach(function(e){return e()}),k("Calling zipy Stop Recorder"),Ze()}catch(e){N("Failed to stop recording")}},window.sdkInit=!0}).catch(function(e){window.sdkInit=!0,N("Failed to get get sdk config from server: ")})}catch(e){N(e)}return function(){}}(e,n.identifyDetails)).then(function(){Ye(S.sdkLoopTime,e),function(e){document.addEventListener("visibilitychange",function(n){if("visible"===document.visibilityState)try{if(he(e)){var t=F();window.zStop=_e(t.inputMasking)}else window.reinitializationInProgress=!0,window.zStop=Xe(),I("reinitializing the session on tabActive event")}catch(e){N("Failed to reinit on tab visibility. Error - "+e.message)}else{for(;window.zEventsData.length;)window.zEventsData.pop();var r=window.zStop;r&&r()}})}(e)});N("Not able to process as sdk api key null or invalid.")}()}catch(e){return r(e)}return o&&o.then?o.then(void 0,r):o}(0,function(e){N("Not able to init SDK: "+e.message)}))}catch(e){return Promise.reject(e)}},Ke=function(e,n){void 0===n&&(n={});try{if(window.self!==window.parent)return}catch(e){N(e.message?e.message:e)}try{if(!window.sdkInit)return N("Identify: SDK not initialized"),void setTimeout(function(){I("Calling identify again after 10 seconds"),function(e,n,t){void 0===n&&(n={}),t>0?Ke(e,n):N("Identify session retries count exceeded")}(e,n,He-=1)},1e4);if(!e||"string"!=typeof e||e.length<=0||e.trim().length<=0)return void N("Got wrong external UUID, Please validate: "+e);I("identify :: externalUUId - "+e);var t=ke(),r=me()||{},o=s.POSTENDUSERINFO,i=n;i.externalId=e;var c=!1;if(t){var u;t.userType==a.ANONYMS||(f=null==(u=t)?void 0:u.zExternalUserInfo,p=i,I("NewEndUserInfo :: "+JSON.stringify(p)),I("PrevEndUserInfo :: "+JSON.stringify(f)),(null==f?void 0:f.externalId)===(null==p?void 0:p.externalId)?o=s.POSTENDUSERINFOANDGETUSERCONFIG:(t.euId=0,t.euZName="",t.userType=a.ANONYMS,t.isBlocked=!1,c=!0,o=s.POSTENDUSERINFOANDGETUSERCONFIG,ze(r.sdkKey),window.reinitializationInProgress=!0))}else{var d=Ce();t={euId:0,euZName:"",userType:a.ANONYMS,isBlocked:!1,zExternalUserInfo:{},zAnonymsUserInfo:{zId:d,euId:0,euZName:""}}}window.iszHandshakeDone||(o=s.POSTENDUSERINFOANDGETUSERCONFIG),t.zExternalUserInfo=i,Oe(t);var l=de();l&&r?!c&&l.isBlocked?I("No need to do backend call if session is blocked"):Pe(r.sdkKey,o,c).then(function(e){c&&(window.zStop=Xe())}).catch(function(e){N("Failed to post/get sdk config from server: ")}):N("Value doesn't exists in sessionBlockInfo or sessionData : ")}catch(e){N("Not able to identify SDK: "+e.message)}var f,p},Ve=function(){try{if(window.self!==window.parent)return}catch(e){N(e.message?e.message:e)}if(window.sdkInit){I("Going to anonymize end user");var e,n=!1;(((e=ke())?e.userType===a.IDENTIFIED:(I("zenduser-info doesn't exists"),0))||function(){var e=Ne();return e?e.userType===a.IDENTIFIED:(I("zenduser-info doesn't exists"),!1)}())&&(n=!0);var t=function(){var e=ke();return e?(e.zExternalUserInfo={},e.userType=a.ANONYMS,Ue(e,!1),e):(I("zenduser Data dosen't exists"),function(){var e=Ne();if(e)return e.zExternalUserInfo={},e.userType=a.ANONYMS,Ue(e,!0),e;I("zenduser Data dosen't exists in temp storage")}())}()||{},r=s.GETUSERCONFIG;0===t.euId?(r=s.POSTENDUSERINFOANDGETUSERCONFIG,Oe(t),Re(t)):(Re(t),be());var o=me();o&&n?(window.reinitializationInProgress=!0,ze(null==o?void 0:o.sdkKey),Pe(null==o?void 0:o.sdkKey,r,!0).then(function(e){window.zStop=Xe()}).catch(function(e){N("Failed to post/get sdk config from server: ")})):I("Identified user doesn't exists in system No need to break session")}else N("Anonymize: SDK not initialized")};function Xe(e){var n=[];try{if(C("Zipy Recorder Reinit"),window.isDataSyncInProgress=!1,!window.stopRecording){I("Going to stop recording ");var t=window.zStop;t&&t()}window.iszInternetDisconnected=!1,window.zEventsPerfData=[],window.zFetchTempData=[],window.zEventsData=[],window.xhrTempData=[],window.stopRecording=!1;var r=F();if(r.domCapture){var o=_e(r.inputMasking);n.push(o)}return n.push(Fe()),Je(r),window.reinitializationInProgress=!1,function(){try{window.stopRecording=!0,k("Calling zipy Stop Recorder"),n.forEach(function(e){return e()}),Ze()}catch(e){N("Failed to stop recording")}}}catch(e){N(e)}return function(){}}function Ye(e,n){setTimeout(Be,e,n)}var $e=function(){try{if(window.self!==window.parent)return""}catch(e){N(e.message?e.message:e)}try{var e=F(),n=ie("zsession-blocked-info"),t=JSON.parse(n);if(!window.sdkInit||t.is_blocked)return N("SessionLink: SDK not initialized"),"";var r=me()||{},o=ie("zId");return e.customerId?S.sessionLinkUrl+"/"+r.sdkKey+"/"+e.customerId+"?is_error=false&id="+o+"&euid="+r.sessionId:(N("SessionLink: Could not find customer id"),"")}catch(e){return N("Error in generating session url. Error is - "+e.message),""}},Qe=function(e,n){try{var t=F();if(!t||t&&!t.captureCustomZipyLogMessage)return void I("Custom Zipy Message not enabled.");if(e&&"string"==typeof e){var r=new CustomEvent(g,{detail:{message:e,options:n}});window.dispatchEvent(r)}else C("Mandatory params missing for zipy logs")}catch(e){C("Error in capturing zipy logs. Error - "+e.message)}},en=function(e){try{var n=F();if(!n||n&&!n.captureCustomZipyLogMessage)return void I("Custom Zipy Exception not enabled.");if(e){var t=new CustomEvent(v,{detail:{error:e instanceof Error?e:{message:String(e)}}});window.dispatchEvent(t)}else C("Mandatory params missing for zipy exception missing")}catch(e){C("Error in capturing zipy exception event. Error - "+e.message)}},nn=function(e,n,t,r){try{var o=F();if(!o||o&&!o.captureCustomZipyLogError)return void I("Custom Zipy Error not enabled.");if(e&&n&&"string"==typeof e&&"string"==typeof n){var i=new CustomEvent(y,{detail:{name:e,message:n,category:t,options:r}});window.dispatchEvent(i)}else C("Mandatory params missing for zipy error logs")}catch(e){N("Error in capturing zipy error event. Error - "+e.message)}},tn={init:We,identify:Ke,anonymize:Ve,getCurrentSessionURL:$e,logError:nn,logException:en,logMessage:Qe};e.anonymize=Ve,e.default=tn,e.getCurrentSessionURL=$e,e.identify=Ke,e.init=We,e.logError=nn,e.logException=en,e.logMessage=Qe});
